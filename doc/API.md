Siad API
========

The siad API is currently under construction. The deprecated way of doing
things is documented at the end of the (incomplete) new documentation. The new
documentation is a spec for the 0.4.0 api. After a round of fixes and
improvments for 0.4.1, the API will be frozen into 'compatibility mode', such
that backwards compatibility is preserved with all apps in future upgrades. The
api may change again when 1.0.0 is released.

The types.Currency object is an infinite precision unsigned integer that gets
represented in json as a base-10 string.

Consensus
---------

Queries:

* /consensus [GET]

#### /consensus [GET]

Function: Returns information about the consensus set, such as the current
block height.

Parameters: none

Response:
```
struct {
	Height       types.BlockHeight (uint64)
	CurrentBlock types.BlockID     (string)
	Target       types.Target      (byte array)
}
```
'Height' is the number of blocks in the blockchain.

'CurrentBlock' is the hash of the current block.

'Target' is the hash that needs to be met by a block for the block to be valid.
The target is inversely proportional to the difficulty.

Wallet
------

Queries:

* /wallet                   [GET]
* /wallet/address           [POST]
* /wallet/close             [PUT]
* /wallet/history           [GET]
* /wallet/history/$(addr)   [GET]
* /wallet/seed              [GET]
* /wallet/seed              [POST]
* /wallet/siacoins          [PUT]
* /wallet/siafunds          [PUT]
* /wallet/transaction/$(id) [GET]
* /wallet/transactions      [GET]
* /wallet/unlock            [PUT]

#### /wallet [GET]

Function: Returns basic information about the wallet, such as whether the
wallet is locked or unlocked.

Parameters: none

Response:
```
struct {
	Encrypted bool
	Unlocked  bool

	ConfirmedSiacoinBalance     types.Currency (string)
	UnconfirmedOutgoingSiacoins types.Currency (string)
	UnconfirmedIncomingSiacoins types.Currency (string)

	SiafundBalance      types.Currency (string)
	SiacoinClaimBalance types.Currency (string)
}
```
'Encrypted' indicates whether the wallet has been encrypted or not. If the
wallet has not been encrypted, then no data has been generated at all, and the
first time the wallet is unlocked, the password given will be used as the
password for encrypting all of the data. Encrypted will only be set to false if
the wallet has never been unlocked before (the unlocked wallet is still
encryped - but the encryption key is in memory).

'Unlocked' indicates whether the wallet is currently locked or unlocked. Some
calls become unavailable when the wallet is locked.

'ConfirmedSiacoinBalance' is the number of siacoins available to the wallet as
of the most recent block in the blockchain.

'UnconfirmedOutgoingSiacoins' is the number of siacoins that are leaving the
wallet according to the set of unconfirmed transactions. Often this number
appears inflated, because outputs are frequently larger than the number of
coins being sent, and there is a refund. These coins are counted as outgoing,
and the refund is counted as incoming. The difference in balance can be
calculated using 'UnconfirmedIncomingSiacoins' - 'UnconfirmedOutgoingSiacoins'

'UnconfirmedIncomingSiacoins' is the number of siacoins are entering the wallet
according to the set of unconfirmed transactions. This number is often inflated
by outgoing siacoins, because outputs are frequently larger than the amount
being sent. The refund will be included in the unconfirmed incoming siacoins
balance.

'SiafundBalance' is the number of siafunds available to the wallet as
of the most recent block in the blockchain.

'SiacoinClaimBalance' is the number of siacoins that can be claimed from the
siafunds as of the most recent block. Because the claim balance increases every
time a file contract is created, it is possible that the balance will increase
before any claim transaction is confirmed.

#### /wallet/address [POST]

Function: Get a new address from the wallet generated by the primary seed. An
error will be returned if the seed has been exhausted (there is a limit on the
number of addresses that can be generated from one seed), or if the wallet is
locked/closed.

Parameters: none

Response:
```
struct {
	Address types.UnlockHash (string)
}
```
'Address' is a Sia address that can receive siacoins or siafunds.

#### /wallet/close [PUT]

Function: Locks and closes the wallet, preparing for shutdown. After being
closed, the keys are encrypted. Queries for the seed, to send siafunds, and
related queries become unavailable. Queries concerning transaction history and
balance are still available.

Parameters: none

Response: Standard.

#### /wallet/history [GET]

Function: Return a list of transactions related to the wallet.

Parameters:
```
struct {
	startHeight types.BlockHeight (uint64)
	endHeight   types.BlockHeight (uint64)
}
```
'startHeight' refers to the height of the block where transaction history
should begin.

'endHeight' refers to the height of of the block where the transaction history
should end. If 'endHeight' is greater than the current height, all transactions
up to and including the most recent block will be provided.

Response:
```
struct {
	ConfirmedHistory   []WalletTransaction
	UnconfirmedHistory []WalletTransaction
}
```
'ConfirmedHistory' lists all of the confirmed wallet transactions appearing
between height 'Start' and height 'End' (inclusive).

'UnconfirmedHistory' lists all of the unconfirmed wallet transactions.

Wallet transactions are transactions that have been processed by the wallet and
given more information, such as a confirmation height and a timestamp. Each
wallet transaction contains information about only a single input or output.
One network transaction with many inputs an outputs can result in many wallet
transactions. All of the wallet transactions created by a network transaction
are guaranteed to be consecutive in history. Wallet transactions will always be
returned in chronological order.

A wallet transaction takes the following form:
```
struct WalletTransaction {
	TransactionID         types.TransactionID (string)
	ConfirmationHeight    types.BlockHeight   (int)
	ConfirmationTimestamp types.Timestamp     (uint64)

	FundType       types.Specifier  (string)
	OutputID       types.OutputID   (string)
	RelatedAddress types.UnlockHash (string)
	Value          types.Currency   (string)
}
```
'TransactionID' is the id of the transaction from which the wallet transaction
was derived. The full transaction can be obtaied by calling
'/wallet/transaction/$(id)'

'ConfirmationHeight' is the height at which the transaction was confirmed. The
height will be set to 'uint64MAX' if the transaction has not been confirmed.

'ConfirmationTimestamp' is the time at which a transaction was confirmed. The
timestamp is a 64bit unix timestamp, and will be set to uint64MAX if the
transaction is unconfirmed.

'FundType' indicates what type of fund is represented by the wallet
transaction. The options are 'Siacoin Input', 'Siacoin Output', 'Siafund
Input', and 'Siafund Output', corresponding to whether the fund is related to
siacoins or siafunds, and to whether the fund is an input to the transaction or
an output of the transaction. When looking at transactions, it should be noted
that a 'Siacoin Input' actually represents outgoing siacoins, as they are an
input to the transaction; they are being spent. A 'Siacoin Output' represents
incoming coins, because the output is being created by the transaction and made
available to the wallet.

'OutputID' is the id of the output. OutputIDs will always be unique.

'RelatedAddress' is the address that is affected. For inputs (outgoing money),
the related address is usually not important because the wallet arbitrarily
selects which addresses will fund a transaction. For outputs (incoming money),
the related address field can be used to determine who has sent money to the
wallet.

'Value' indicates how much money has been moved in the input or output.

#### /wallet/history/$(addr) [GET]

Function: Return all of the transaction related to a specific address.

Parameters: none

Response:
```
struct {
	Transactions []WalletTransaction
}
```
'Transactions' is a list of 'WalletTransactions' that affect the input address.
See the documentation for '/wallet/history' for more information.

#### /wallet/seed [GET]

Function: Return the seed that is being used to generate addresses. This seed
can be used to derive secret keys, and must be kept safe. This call is
unavailable when the wallet is locked or closed.

Parameters:
```
struct {
	dictionary string
}
```
'dictionary' is the name of the dictionary that should be used when encoding
the seed.

Response:
```
struct {
	PrimarySeed        mnemonics.Phrase (string)
	AddressesRemaining int
	AllSeeds           []mnemonics.Phrase (array of strings)
}
```
'PrimarySeed' is the seed that is actively being used to generate new addresses
for the wallet.

'AddressesRemaining' is the number of addresses that remain in the primary seed
until exhaustion has been reached and no more addresses will be generated.

'AllSeeds' is a list of all seeds that the wallet references when scanning the
blockchain for outputs. The wallet is able to spend any output generated by any
of the seeds, however only the primary seed is being used to generate new
addresses.

A seed is an encoded version of a 128 bit random seed. The output is 15 words
chosen from a small dictionary as indicated by the input. The most common
choice for the dictionary is going to be 'english'. The underlying seed is the
same no matter what dictionary is used for the encoding. The encoding also
contains a small checksum of the seed, to help catch simple mistakes when
copying. The library
[entropy-mnemonics](https://github.com/NebulousLabs/entropy-mnemonics) is used
when encoding.

#### /wallet/seed [POST]

Function: Fetch a new seed for the wallet. The old seed will be added to the
list of backup seeds. In general, this call should be avoided unless address
exhaustion is reached. The encryption password is required to make this change.

Parameters:
```
struct {
	encryptionKey string
	dictionary    string
}
```
'encryptionKey' is the key that is used to encrypt the new seed when it is
saved to disk.

'dictionary' is the name of the dictionary that should be used when encoding
the newly created seed. 'english' is the most common choice.

Response:
```
struct {
	NewSeed Phrase (string)
}
```
'NewSeed' is the new seed that will be used as the seed for generating new
addresses.

#### /wallet/siacoins [POST]

Function: Send siacoins to an address. The outputs are arbitrarily selected
from addresses in the wallet.

Parameters:
```
struct {
	amount      int
	destination string
}
```
'amount' is the number of siacoins being sent.

'destination' is the address that is receiving the coins.

Response: standard

#### /wallet/siafunds [POST]

Function: Send siafunds to an address. The outputs are arbitrarily selected
from addresses in the wallet. Any siacoins available in the siafunds being sent
(as well as the siacoins available in any siafunds that end up in a refund
address) will become available to the wallet as siacoins after 144
confirmations. To access all of the siacoins in the siacoin claim balance, send
all of the siafunds to an address in your control (this will give you all the
siacoins, while still letting you control the siafunds).

Parameters:
```
struct {
	amount      int
	destination string
}
```
'amount' is the number of siafunds being sent.

'destination' is the address that is receiving the funds.

Response: standard

#### /wallet/transaction/$(id) [GET]

Function: Get the transaction associated with a specific transaction id.

Parameters: none

Response:
```
struct {
	Transaction types.Transaction
}
```
'Transaction' is a 'types.Transaction'. The full transaction can be seen in
types.transaction.go. All hashes in the transaction are encoded as strings.

#### /wallet/transactions [GET]

Function: Return all raw transactions relevant to the wallet in a block range.
Raw transactions are missing metadata such as confirmation height.

Parameters:
```
struct {
	startHeight int
	endHeight   int
}
```
'startHeight' refers to the height of the block where transaction history
should begin.

'endHeight' refers to the height of of the block where the transaction history
should end. If 'endHeight' is greater than the current height, all transactions
up to and including the most recent block will be provided.

Response:
```
struct {
	ConfirmedTransactions   []types.Transaction
	UnconfirmedTransactions []types.Transaction
}
```
'ConfirmedTransactions' lists all of the confirmed transactions appearing
between height 'startHeight' and height 'endHeight' (inclusive).

'UnconfirmedTransactions' lists all of the unconfirmed transactions.

#### /wallet/unlock [PUT]

Function: Unlock the wallet. The wallet is capable of knowing whether the
correct password was provided. The first time that the wallet is unlocked ever,
the password used will become the permanent password. Any string can be used as
the key, though it is generally recommended that the encoded primary seed be
used.

Parameters:
```
struct {
	encryptionKey string
}
```

Response: standard

Siad API (Deprecated)
=====================

All API calls return JSON objects. If there is an error, the error is returned
in plaintext with an appropriate HTTP error code. The standard response is {
"Success": true }. In this document, the API responses are defined as Go
structs. The structs will be encoded to JSON before being sent; they are used
here to provide type information.

At version 0.4, the API will be locked into forwards compatibility. This means
that we will not add new required parameters or remove response fields. We may,
however, add additional fields and optional parameters, and we may disable
parameters. It should be noted that significant changes in the API are planned
between 0.3.3.2 and 0.4.

There may be functional API calls which are not documented. These are not
guaranteed to be supported beyond the current release, and should not be used
in production.

The default port for the API is "localhost:9980". This can be changed using the
'-a' flag when running siad.

Consensus
---------

Queries:

* /consensus/status
* /consensus/synchronize

#### /consensus/status

Function: Returns information about the consensus set, such as the current
block height.

Parameters: none

Response:
```
struct {
	Height       int
	CurrentBlock [32]byte
	Target       [32]byte
}
```

#### /consensus/synchronize

Function: Will force synchronization of the local node and the rest of the
network. May take a while. Should only be necessary for debugging.

Parameters: none

Reponse: standard

Daemon
------

Queries:

* /daemon/stop
* /daemon/version
* /daemon/updates/apply
* /daemon/updates/check

#### /daemon/stop

Function: Cleanly shuts down the daemon. May take a while.

Parameters: none

Response: standard

#### /daemon/version

Function: Returns the daemon's version

Parameters: none

Response:
```
version string
```

#### /daemon/updates/apply:

Function: Applies the update specified by `version`.

Parameters:
```
version string
```

Response: standard

#### /daemon/updates/check:

Function: Checks for an update, returning a bool indicating whether
there is an update and a version indicating the version of the update.

Parameters: none

Response:
```
struct {
	Available bool
	Version   string
}
```

Gateway
-------

Queries:

* /gateway/status
* /gateway/peers/add
* /gateway/peers/remove

#### /gateway/status

Function: Returns information about the gateway, including the list of peers.

Parameters: none

Response:
```
struct {
	Address NetAddress
	Peers   []string
}
```

#### /gateway/peers/add

Function: Will add a peer to the gateway.

Parameters:
```
address string
```
`address` should be a reachable hostname + port number, typically of the form
"a.b.c.d:xxxx".

Response: standard

#### /gateway/peers/remove

Function: Will remove a peer from the gateway.

Parameters:
```
address string
```
`address` should be a reachable hostname + port number, typically of the form
"a.b.c.d:xxxx".

Response: standard

Host
----

Queries:

* /host/announce
* /host/configure
* /host/status

#### /host/announce

Function: The host will announce itself to the network as a source of storage.
Generally only needs to be called once.

Parameters: none

Response: standard

#### /host/configure

Function: Configures hosting parameters. All parameters are optional;
unspecified parameters will be left unchanged.

Parameters:
```
totalStorage int
minFilesize  int
maxFilesize  int
minDuration  int
maxDuration  int
windowSize   int
price        int
collateral   int
```
`totalStorage` is how much storage (in bytes) the host will rent to the
network.

`minFilesize` is the minimum allowed file size.

`maxFilesize` is the maximum allowed file size.

`minDuration` is the minimum amount of time a contract is allowed to last.

`maxDuration` is the maximum amount of time a contract is allowed to last.

`windowSize` is the number of blocks a host has to prove they are holding the
file.

`price` is the cost (in Hastings per byte) of data stored.

`collateral` is the amount of collateral the host will offer (in Hastings per
byte per block) for losing files on the network.

Response: standard

#### /host/status

Function: Queries the host for its configuration values, as well as the amount
of storage remaining and the number of contracts formed.

Parameters: none

Response:
```
struct {
	TotalStorage     int
	MinFilesize      int
	MaxFilesize      int
	MinDuration      int
	MaxDuration      int
	WindowSize       int
	Price            int
	Collateral       int
	StorageRemaining int
	NumContracts     int
}
```

HostDB
------

Queries:

* /hostdb/hosts/active

#### /hostdb/hosts/active

Function: Lists all of the active hosts in the hostdb.

Parameters: none

Response:
```
struct {
	Hosts []HostSettings
}
```

Miner
-----

Queries:

* /miner/blockforwork
* /miner/start
* /miner/status
* /miner/stop
* /miner/submitblock

#### /miner/blockforwork

Function: Provides a block that is ready for the blockchain except for having
an invalid target. An external miner is expected to try nonces until a block
with a valid target is found. Every block returned by this call will have a
unique hash - miners can start at nonce 0 without worrying about trying the
same block twice.

Parameters: none

Response:
```
[]byte
```
The response is a byte array containing a targe followed by a block header
followed by a block. The target is the first 32 bytes. The block header is the
following 80 bytes, and the nonce is bytes 32-39 (inclusive) of the header
(bytes 64-71 of the whole array). The remaining bytes are the block. Hashing
the header will result in the block id, which must be lower than the target.
When submitting a solved block, you need to update the nonce in the block. The
nonce is at bytes 32-39 (inclusive) of the block, or bytes 144-151 of the whole
field. When submitting the block to /miner/submitblock, only submit the block
and not the target or header.

Layout:

0-31: target

32-111: header

112+: block

32-39 of header: header nonce

32-39 of block: block nonce

When submitting the block, update the nonce and submit only the block (bytes
112+).

#### /miner/start

Function: Tells the miner to begin mining on `threads` threads.

Parameters:
```
threads int
```

Response: standard

#### /miner/status

Parameters: none

Response:
```
struct {
	Mining         bool
	State          string
	Threads        int
	RunningThreads int
	Address        [32]byte
}
```
If the `Mining` flag is set, the miner is currently mining. Otherwise it is
not.

`State` gives a more nuanced description of the miner, including
transitional states.

`Threads` indicates the number of desired threads, while
`RunningThreads` is the number of currently active threads. If the miner finds
a block,

`Address` is the address that will receive the coinbase.

#### /miner/stop

Function: Stops the miner.

Parameters: none

Response: standard

#### /miner/submitblock

Function: Submits a block to the miner. The block is submitted as an encoded
byte slice. The block does not need to be modified from the block provided by
/miner/blockforwork except that the nonce must be updated. The nonce can be
found at bytes 32-39 (inclusive) of the block.

Response Body:
```
[]byte
```

Response: standard

Renter
------

Queries:

* /renter/downloadqueue
* /renter/files/delete
* /renter/files/download
* /renter/files/list
* /renter/files/load
* /renter/files/loadascii
* /renter/files/rename
* /renter/files/share
* /renter/files/shareascii
* /renter/files/upload

#### /renter/downloadqueue

Function: Lists all files in the download queue.

Parameters: none

Response:
```
[]struct{
	Complete    bool
	Filesize    uint64
	Received    uint64
	Destination string
	Nickname    string
}
```
Each file in the queue is represented by the above struct.

`Complete` indicates whether the file is ready to be used. Note that `Received
== Filesize` does not imply `Complete`, because the file may require
additional processing (e.g. decryption) after all of the raw bytes have been
downloaded.

`Filesize` is the size of the file being download.

`Received` is the number of bytes downloaded thus far.

`Destination` is the path that the file was downloaded to.

`Nickname` is the nickname given to the file when it was uploaded.

#### /renter/files/delete

Function: Deletes a renter file entry. Does not delete any downloads or
original files, only the entry in the renter.

Parameters:
```
nickname string
```
`nickname` is the nickname of the file that has been uploaded to the network.

Response: standard

#### /renter/files/download

Function: Starts a file download.

Parameters:
```
nickname    string
destination string
```
`nickname` is the nickname of the file that has been uploaded to the network.

`destination` is the path that the file will be downloaded to.

Response: standard

#### /renter/files/list

Function: Lists the status of all files.

Parameters: none

Response:
```
[]struct {
	Available     bool
	Nickname      string
	Repairing     bool
	TimeRemaining int
}
```
Each uploaded file is represented by the above struct.

`Available` indicates whether or not the file can be downloaded immediately.

`Nickname` is the nickname given to the file when it was uploaded.

`Repairing` indicates whether the file is currently being repaired. It is
typically best not to shut down siad until files are no longer being repaired.

`TimeRemaining` indicates how many blocks the file will be available for.

#### /renter/files/load

Function: Load a '.sia' into the renter.

Parameters:
```
filename string
```
`filename` is the filepath of the '.sia' that is being loaded.

Response:
```
struct {
	FilesAdded []string
}
```

#### /renter/files/loadascii

Function: Load a '.sia' into the renter.

Parameters:
```
file string
```
`file` is the ASCII representation of the '.sia' file being loaded into the
renter.

Response:
```
struct {
	FilesAdded []string
}
```

#### /renter/files/rename

Function: Rename a file. Does not rename any downloads or source files, only
renames the entry in the renter.

Parameters:
```
nickname string
newname  string
```
`nickname` is the current name of the file entry.

`newname` is the new name for the file entry.

Response: standard.

#### /renter/files/share

Function: Create a '.sia' that can be shared with other people.

Parameters:
```
nickname string
filepath string
```
`nickname` is the nickname of the file that will be shared.

`filepath` is the filepath of the '.sia' that will be created to share the
file. `filepath` must have the suffix '.sia'.

Response: standard.

#### /renter/files/shareascii

Function: Create a '.sia' that can be shared with other people.

Parameters:
```
nickname string
```
`nickname` is the nickname of the file that will be shared.

Response:
```
File string
```
`file` is the ASCII representation of the '.sia' that would have been created.

#### /renter/files/upload

Function: Upload a file.

Parameters:
```
source   string
nickname string
```
`source` is the path to the file to be uploaded.

`nickname` is the name that will be used to reference the file.

Response: standard.

Transaction Pool
----------------

Queries:

* /transactionpool/transactions

#### /transactionpool/transactions

Function: Returns all of the transactions in the transaction pool.

Parameters: none

Response:
```
struct {
	Transactions []consensus.Transaction
}
```
Please see consensus/types/transactions.go for a more detailed explanation on
what a transaction looks like. There are many fields.

Wallet
------

Queries:

* /wallet/address
* /wallet/send
* /wallet/siafunds/balance
* /wallet/siafunds/send
* /wallet/siafunds/watchsiagaddress
* /wallet/status

#### /wallet/address

Function: Returns an address that is spendable by the wallet.

Parameters: none

Response:
```
struct {
	Address string
}
```
`Address` is the hex representation of a wallet address.

#### /wallet/send

Function: Sends coins to a destination address.

Parameters:
```
amount      int
destination string
```
`amount` is a volume of coins to send, in Hastings.

`destination` is the hex representation of the recipient address.

Response: standard

#### /wallet/siafunds/balance

Function: Display the balance of siafunds tracked by the wallet.

Parameters: none

Response:
```
struct {
	SiafundBalance      int
	SiacoinClaimBalance int
}
```

#### /wallet/siafunds/send

Function: Send siafunds tracked by the wallet. The siacoins stored in the
siafunds are sent to the wallet.

Parameters:
```
amount      int
destination string
keyfiles    string
```
`amount` is a volume of coins to send, in Hastings.

`destination` is the hex representation of the recipient address.

`keyfiles` is a comma-separated list of files containing the keys used to
unlock the siafunds.

#### /wallet/siafunds/watchsiagaddress

Function: Track a new siafund address.

Parameters:
```
keyfile string
```
`keyfile` is a file containing a key corresponding to the address.


Response: standard

#### /wallet/status

Function: Get the status of the wallet.

Parameters: none

Response:
```
struct {
	Balance      int
	FullBalance  int
	NumAddresses int
}
```
`Balance` is the spendable balance of the wallet.

`FullBalance` is the balance of the wallet, including unconfirmed coins.

`NumAddresses` is the number of addresses controlled by the wallet.

Block Explorer
--------------

Queries:

* /blockexplorer/status
* /blockexplorer/blockdata

### /blockexplorer/status

Function: Returns the status of the blockchain and some
statistics. All Siacoin amounts are given in Hastings

Parameters: None

Response:
```
struct {
	Height int
	Block  Types.Block
	Target []byte
	CurrencySent  int
	TotalCurrency int
	ActiveContractCount int
	ActiveContractcosts int
	TotalContractCount int
	TotalContractcosts int
}
```
`Height` is the current height of the blockchain.

`Block` is the most recently mined valid block. See types/block.go for
a detailed specification of a block structure.

`Target` is the target at which the current block has been mined at.

`TotalCurrency` is the total amount of siacoins in ciculation

`ActiveContractCount` is the number of file contracts that are currently in place.

`ActiveContractCosts` is the amount of siacoins that are currently tied
up in file contracts.

`TotalContractCount` is the number of file contracts that have ever
took place

`TotalContractCosts` is the amount of siacoins that have ever been
spent on file contracts

### /blockexplorer/blockdata

Function: Return information about specific blocks

Parameters:
```
start  int
finish int
```
`start` is the starting block height.

`finish` is the finishing block height.

Response:
```
[]struct {
	 Timestamp int
	 Target    int
	 Size	   int
}

`Timestamp` is the timestamp registered on the block.

`Target` is the target at which the block was mined at.

`Size` is the size, in bytes of the marshalled block.
